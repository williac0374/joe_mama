<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Template</title>
<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: white;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>
window.onerror = function(message, source, lineno, colno, error) {let code = localStorage.getItem("codeIDE");let getScriptLine = code => code.split("<script>")[0].split("\n").length;let ln = (getScriptLine(code)-1) + lineno;msg = message+" , line :"+ ln+" , column: " +colno+ " , " +error;let errorCursor = {"line":ln,"ch":colno,"sticky":null};localStorage.setItem("errorCursorIDE",JSON.stringify(errorCursor));alert(msg);window.close();}

canvas.width=640;
canvas.height=360;
j_walk=null;joe=null

function start(){
  ///sets up sprites
  b_drop = draw_set_image('joeParts/joe_background.png')
  
  j_walk =  draw_set_image('joeParts/joe_walking.png');
  j_walk.loaded=false;
j_walk.onload = function () {j_walk.loaded=true};
  
  j_punch =  draw_set_image('joeParts/joe_punching.png');
  j_punch.loaded=false;
j_punch.onload = function () {j_punch.loaded=true};
  
  j_kick =  draw_set_image('joeParts/joe_kicking.png');
  j_kick.loaded=false;
j_kick.onload = function () {j_kick.loaded=true};
  
  ///////////////////////////////////////////////////////////
joe = {x:canvas.width/2, y:270-128, dx:1, spr:j_kick, frm:0}
  setInterval(function(){
    joe.frm++
    if(joe.frm>=joe.spr.width/joe.spr.height)joe.frm=0
  },200);
  change_frame();
}
function change_frame(){
  joe.spr=choose(j_walk,j_punch,j_kick)
  joe.dx*=-1
  setTimeout(function(){change_frame()},Math.random()*2000);
}
function loop(){
  if(joe.spr==j_walk){joe.x+=joe.dx}
  if(joe.x>canvas.width-400){joe.dx*=-1}
  if(joe.x<128){joe.dx*=-1}
  input()
  document.title = mouse_y
}

function draw(){
  draw_image(b_drop,0,0,canvas.width,canvas.height)
  draw_strip(joe.x,joe.y,joe.spr,joe.frm)
  //draw_text(100,100,mouse_x+' , '+mouse_y,24)
}

function input(){
  if(mouse_check_pressed()){
    canvas.style.width = window.innerWidth+'px'
    canvas.style.height = window.innerHeight+'px'
  }
}

function draw_strip(x,y,strip,frame){
  var scale = 1
  if (strip.loaded==false) return;
  let frames = strip.width/strip.height
  if(frame>=frames) frame=frames-1 // locks it at last frame if asked to draw more frames than it has
  //draw_image(img,x,y,w,h,rot,ox,oy,source_x,source_y,source_w,source_h){
  draw_image(strip,x,y,strip.height*scale,strip.height*scale,0,0,0,(strip.width/frames)*frame,0,strip.width/frames,strip.height)
  
  
}
</script>
<script type='text/javascript' src='engine.js'></script>

</body>
</html>
