by<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#000000">
<title>Joe Mama</title>

<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: white;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>
window.onerror = function(message, source, lineno, colno, error) {let code = localStorage.getItem("codeIDE");let getScriptLine = code => code.split("<script>")[0].split("\n").length;let ln = (getScriptLine(code)-1) + lineno;msg = message+" , line :"+ ln+" , column: " +colno+ " , " +error;let errorCursor = {"line":ln,"ch":colno,"sticky":null};localStorage.setItem("errorCursorIDE",JSON.stringify(errorCursor));alert(msg);window.close();}
mx = my = 0;
canvas.width=640;
canvas.height=360;
j_walk=null;joe=null
setTimeout(function(){canvas.style.width = window.innerWidth+'px';canvas.style.height = window.innerHeight+'px'},10);
function start(){
  ///sets up sprites
  b_drop = draw_set_image('joeParts/joe_background.png')
  
  p_spr = draw_set_image('joeParts/punchy2.png')
  p_spr.loaded=false;
p_spr.onload = function () {p_spr.loaded=true};
  
  j_walk =  draw_set_image('joeParts/joe_walking.png');
  j_walk.loaded=false;
j_walk.onload = function () {j_walk.loaded=true};
  
  j_walk_hurt =  draw_set_image('joeParts/joe_walking_hurt.png');
  j_walk_hurt.loaded=false;
j_walk_hurt.onload = function () {j_walk_hurt.loaded=true};
  
  j_punch =  draw_set_image('joeParts/joe_punching.png');
  j_punch.loaded=false;
j_punch.onload = function () {j_punch.loaded=true};
  
  j_kick =  draw_set_image('joeParts/joe_kicking.png');
  j_kick.loaded=false;
j_kick.onload = function () {j_kick.loaded=true};
  
  ///////////////////////////////////////////////////////////
joe = {x:canvas.width/2, y:146, dx:-1, spr:j_walk, frm:0}
punchy = {x:175, y:146, dx:0, spr:p_spr, frm:0}
  setInterval(function(){
    joe.frm++
    if(joe.frm>=joe.spr.width/joe.spr.height)joe.frm=0
  },200);
  //change_frame();
start = {x:-100,y:0}
end = {x:-100,y:0}
}
function change_frame(){
  joe.spr=choose(j_walk,j_walk,j_walk,j_walk,j_walk,j_walk,j_punch,j_kick,j_punch,j_kick)
  //joe.dx*=-1
setTimeout(function(){change_frame()},Math.random()*2000);
}
function loop(){
  punchy.x+=punchy.dx // moves punchy if applicable
  // collision detection
  if(punchy.x>joe.x-32 && joe.spr==j_walk){ // joe is hit while walking
    joe.x+=40
    joe.spr=j_walk_hurt
  punchy.frm=1;setTimeout(function(){punchy.frm=0},600)
  }
  if(punchy.x>joe.x-60 && joe.spr==j_punch){ // joe is hit while punching and extended
  if(joe.frm==3){punchy.x-=64;punchy.frm=2;setTimeout(function(){punchy.frm=0},600)}else{joe.x+=2}
  }
  if(punchy.x>joe.x-74 && joe.spr==j_kick){ // joe is hit while kicking and extended
  if(joe.frm==2){punchy.x-=128;punchy.frm=2;setTimeout(function(){punchy.frm=0},800)}else{joe.x+=2}
  }
  
if(joe.spr==j_walk){joe.x+=joe.dx} // moves joe if applicable
  input()
}

function draw(){
  draw_image(b_drop,0,0,canvas.width,canvas.height)
  draw_strip(joe.x,joe.y,joe.spr,joe.frm)
  draw_strip(punchy.x,punchy.y,punchy.spr,punchy.frm)
  //draw_text(100,100,mouse_x+' , '+mouse_y,24)
  draw_set_color(0,255,0);draw_circle(start.x, start.y, 12, false)
  draw_set_color(255,0,0);draw_circle(end.x, end.y, 12, false)
  //draw_set_color(255,0,0);draw_text(100,100,floor(mx-joe.x),24)
  
}

function input(){
  /////////////////////////////////////////////
  ///ZOOM CORRECTION
  //////////////////////////////////////////////
  var rect = canvas.getBoundingClientRect()
  var scaleX = canvas.width / rect.width;
  var scaleY = canvas.height / rect.height;
  mx = mouse_x  * scaleX;
  my = mouse_y  * scaleY;
  /////////////////////////////////////////////
  gesture();
}



function gesture(){
  let dis = 50;
  let dir = 0;
  let swipe='none'
  
  if(mouse_check_pressed()){
    start.x = mx;
    start.y = my;
  }
  if(mouse_check_released()){
    swipe='none'
    end.x = mx;
    end.y = my;
    if(point_distance(start.x,start.y,end.x,end.y)>dis){
      dir = point_direction(start.x,start.y,end.x,end.y)
    if(dir>45 && dir<135){swipe='up'}
    if(dir<=45 && dir>=-45){swipe='right'}
    if(dir<-45 && dir>-135){swipe='down'}
    if(dir>=135 || dir<=-135){swipe='left'}
    }
    if( swipe=='none'){ // makes joe walk towards touch
      if(end.x<joe.x){
        joe.dx = -1
      }else{
        joe.dx = 1
      }
      joe.spr=j_walk;
    }
    if( swipe=='left'){ // makes joe punch
      joe.dx=0;
      joe.frm=2;
      joe.spr=j_punch;
    }
  }
  
  
}


function draw_strip(x,y,strip,frame){
  var scale = 1
  if (strip.loaded==false) return;
  let frames = strip.width/strip.height
  if(frame>=frames) frame=frames-1 // locks it at last frame if asked to draw more frames than it has
  //draw_image(img,x,y,w,h,rot,ox,oy,source_x,source_y,source_w,source_h){
    draw_image(strip,x,y,strip.height*scale,strip.height*scale,0,0,0,(strip.width/frames)*frame,0,strip.width/frames,strip.height)
    
    
  }
  </script>
  <script type='text/javascript' src='engine.js'></script>
  
  </body>
  </html>
  
  
  
